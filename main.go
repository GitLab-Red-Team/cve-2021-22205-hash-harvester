package main

import (
	"fmt"
	"gitlab.com/gitlab-red-team/cve-2021-22205-hash-harvester/semver"
	"gitlab.com/gitlab-red-team/cve-2021-22205-hash-harvester/storage"
	"gitlab.com/gitlab-red-team/cve-2021-22205-hash-harvester/tags"
)

func main() {
	allTagNames := tags.GetAllTags()
	vulnerableTags := semver.GetVulnerableTags(allTagNames)
	fmt.Printf("\n[*] Found a total of %d tags for GitLab EE and CE editions, %d of which match the vulnerable semver constraints provided.\n", len(allTagNames), len(vulnerableTags))
	exitErr := semver.UpdateVulnerableTagsWithHashes(vulnerableTags)
	if exitErr != nil {
		panic(exitErr)
	}
	fmt.Println("[*] Vulnerable hashes:")
	results, err := storage.GetDistinctHashes()
	if err != nil {
		panic(err)
	}
	for _, result := range results {
		fmt.Printf("%s\n", result)
	}
}
