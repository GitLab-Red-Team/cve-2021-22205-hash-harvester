package semver

import (
	"github.com/Masterminds/semver"
	"strings"
)

func panicOnError(err error) {
	if err == nil {
		return
	}
	panic(err)
}

func getTypedConstraints(constraintStrings []string) ([]*semver.Constraints, error) {
	var constraints []*semver.Constraints
	for _, s := range constraintStrings {
		constraint, err := semver.NewConstraint(s)
		if err != nil {
			return nil, err
		}
		constraints = append(constraints, constraint)
	}
	return constraints, nil
}

func getRawVersionNumber(version string) string {
	updatedVersion := strings.Split(version, "-")
	return updatedVersion[0]
}

func VersionIsInRange(constraints []string, version string) (bool, error) {
	typedConstraints, typedConstraintsErr := getTypedConstraints(constraints)
	if typedConstraintsErr != nil {
		return false, typedConstraintsErr
	}
	updatedVersion := getRawVersionNumber(version)
	typedVersion, newVersionErr := semver.NewVersion(updatedVersion)
	if newVersionErr != nil {
		return false, newVersionErr
	}
	for _, c := range typedConstraints {
		if c.Check(typedVersion) {
			return true, nil
		}
	}
	return false, nil
}
